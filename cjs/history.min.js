"use strict";function _interopDefault(t){return t&&"object"==typeof t&&"default"in t?t.default:t}Object.defineProperty(exports,"__esModule",{value:!0});var resolvePathname=_interopDefault(require("resolve-pathname")),valueEqual=_interopDefault(require("value-equal"));require("tiny-warning");var invariant=_interopDefault(require("tiny-invariant"));function _extends(){return(_extends=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t}).apply(this,arguments)}function addLeadingSlash(t){return"/"===t.charAt(0)?t:"/"+t}function stripLeadingSlash(t){return"/"===t.charAt(0)?t.substr(1):t}function hasBasename(t,n){return 0===t.toLowerCase().indexOf(n.toLowerCase())&&-1!=="/?#".indexOf(t.charAt(n.length))}function stripBasename(t,n){return hasBasename(t,n)?t.substr(n.length):t}function stripTrailingSlash(t){return"/"===t.charAt(t.length-1)?t.slice(0,-1):t}function parsePath(t){var n=t||"/",e="",a="",o=n.indexOf("#");-1!==o&&(a=n.substr(o),n=n.substr(0,o));var r=n.indexOf("?");return-1!==r&&(e=n.substr(r),n=n.substr(0,r)),{pathname:n,search:"?"===e?"":e,hash:"#"===a?"":a}}function createPath(t){var n=t.pathname,e=t.search,a=t.hash,o=n||"/";return e&&"?"!==e&&(o+="?"===e.charAt(0)?e:"?"+e),a&&"#"!==a&&(o+="#"===a.charAt(0)?a:"#"+a),o}function createLocation(t,n,e,a){var o;"string"==typeof t?(o=parsePath(t)).state=n:(void 0===(o=_extends({},t)).pathname&&(o.pathname=""),o.search?"?"!==o.search.charAt(0)&&(o.search="?"+o.search):o.search="",o.hash?"#"!==o.hash.charAt(0)&&(o.hash="#"+o.hash):o.hash="",void 0!==n&&void 0===o.state&&(o.state=n));try{o.pathname=decodeURI(o.pathname)}catch(t){throw t instanceof URIError?new URIError('Pathname "'+o.pathname+'" could not be decoded. This is likely caused by an invalid percent-encoding.'):t}return e&&(o.key=e),a?o.pathname?"/"!==o.pathname.charAt(0)&&(o.pathname=resolvePathname(o.pathname,a.pathname)):o.pathname=a.pathname:o.pathname||(o.pathname="/"),o}function locationsAreEqual(t,n){return t.pathname===n.pathname&&t.search===n.search&&t.hash===n.hash&&t.key===n.key&&valueEqual(t.state,n.state)}function createTransitionManager(){var r=null;var a=[];return{setPrompt:function(t){return r=t,function(){r===t&&(r=null)}},confirmTransitionTo:function(t,n,e,a){if(null!=r){var o="function"==typeof r?r(t,n):r;"string"==typeof o?"function"==typeof e?e(o,a):a(!0):a(!1!==o)}else a(!0)},appendListener:function(t){var n=!0;function e(){n&&t.apply(void 0,arguments)}return a.push(e),function(){n=!1,a=a.filter(function(t){return t!==e})}},notifyListeners:function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];a.forEach(function(t){return t.apply(void 0,n)})}}}var canUseDOM=!("undefined"==typeof window||!window.document||!window.document.createElement);function getConfirmation(t,n){n(window.confirm(t))}function supportsHistory(){var t=window.navigator.userAgent;return(-1===t.indexOf("Android 2.")&&-1===t.indexOf("Android 4.0")||-1===t.indexOf("Mobile Safari")||-1!==t.indexOf("Chrome")||-1!==t.indexOf("Windows Phone"))&&(window.history&&"pushState"in window.history)}function supportsPopStateOnHashChange(){return-1===window.navigator.userAgent.indexOf("Trident")}function supportsGoWithoutReloadUsingHash(){return-1===window.navigator.userAgent.indexOf("Firefox")}function isExtraneousPopstateEvent(t){return void 0===t.state&&-1===navigator.userAgent.indexOf("CriOS")}var PopStateEvent="popstate",HashChangeEvent="hashchange";function getHistoryState(){try{return window.history.state||{}}catch(t){return{}}}function createBrowserHistory(t){void 0===t&&(t={}),canUseDOM||invariant(!1);var c=window.history,s=supportsHistory(),n=!supportsPopStateOnHashChange(),e=t.forceRefresh,h=void 0!==e&&e,a=t.getUserConfirmation,o=void 0===a?getConfirmation:a,r=t.keyLength,i=void 0===r?6:r,u=t.basename?stripTrailingSlash(addLeadingSlash(t.basename)):"";function f(t){var n=t||{},e=n.key,a=n.state,o=window.location,r=o.pathname+o.search+o.hash;return u&&(r=stripBasename(r,u)),createLocation(r,a,e)}function l(){return Math.random().toString(36).substr(2,i)}var d=createTransitionManager();function v(t){_extends(S,t),S.length=c.length,d.notifyListeners(S.location,S.action)}function p(t){isExtraneousPopstateEvent(t)||w(f(t.state))}function g(){w(f(getHistoryState()))}var P=!1;function w(n){if(P)P=!1,v();else{d.confirmTransitionTo(n,"POP",o,function(t){t?v({action:"POP",location:n}):function(t){var n=S.location,e=m.indexOf(n.key);-1===e&&(e=0);var a=m.indexOf(t.key);-1===a&&(a=0);var o=e-a;o&&(P=!0,x(o))}(n)})}}var y=f(getHistoryState()),m=[y.key];function H(t){return u+createPath(t)}function x(t){c.go(t)}var L=0;function O(t){1===(L+=t)&&1===t?(window.addEventListener(PopStateEvent,p),n&&window.addEventListener(HashChangeEvent,g)):0===L&&(window.removeEventListener(PopStateEvent,p),n&&window.removeEventListener(HashChangeEvent,g))}var E=!1;var S={length:c.length,action:"POP",location:y,createHref:H,push:function(t,n){var i=createLocation(t,n,l(),S.location);d.confirmTransitionTo(i,"PUSH",o,function(t){if(t){var n=H(i),e=i.key,a=i.state;if(s)if(c.pushState({key:e,state:a},null,n),h)window.location.href=n;else{var o=m.indexOf(S.location.key),r=m.slice(0,o+1);r.push(i.key),m=r,v({action:"PUSH",location:i})}else window.location.href=n}})},replace:function(t,n){var r="REPLACE",i=createLocation(t,n,l(),S.location);d.confirmTransitionTo(i,r,o,function(t){if(t){var n=H(i),e=i.key,a=i.state;if(s)if(c.replaceState({key:e,state:a},null,n),h)window.location.replace(n);else{var o=m.indexOf(S.location.key);-1!==o&&(m[o]=i.key),v({action:r,location:i})}else window.location.replace(n)}})},go:x,goBack:function(){x(-1)},goForward:function(){x(1)},block:function(t){void 0===t&&(t=!1);var n=d.setPrompt(t);return E||(O(1),E=!0),function(){return E&&(E=!1,O(-1)),n()}},listen:function(t){var n=d.appendListener(t);return O(1),function(){O(-1),n()}}};return S}var PopStateEvent$1="popstate",HashChangeEvent$1="hashchange";function getHistoryState$1(){try{return window.history.state||{}}catch(t){return{}}}function createBrowserHistory$1(t){void 0===t&&(t={}),canUseDOM||invariant(!1);var c=window.history,s=supportsHistory(),n=!supportsPopStateOnHashChange(),e=t.forceRefresh,h=void 0!==e&&e,a=t.getUserConfirmation,o=void 0===a?getConfirmation:a,r=t.keyLength,i=void 0===r?6:r,u=t.basename?stripTrailingSlash(addLeadingSlash(t.basename)):"";function f(t){var n=t||{},e=n.key,a=n.state,o=window.location,r=o.pathname+o.search+o.hash;return u&&(r=stripBasename(r,u)),createLocation(r,a,e)}function l(){return Math.random().toString(36).substr(2,i)}var d=createTransitionManager(),v=[];function p(t){_extends(k,t),k.length=c.length;var n=v.findIndex(function(t){return t.location.pathname==k.location.pathname&&t.location.search==k.location.search&&t.location.hash==k.location.hash});-1!=n&&v.splice(n),v.push({location:k.location,action:k.action})}function g(t){isExtraneousPopstateEvent(t)||y(f(t.state))}function P(){y(f(getHistoryState$1()))}var w=!1;function y(n){if(w)w=!1,p();else{d.confirmTransitionTo(n,"POP",o,function(t){t?p({action:"POP",location:n}):function(t){var n=k.location,e=H.indexOf(n.key);-1===e&&(e=0);var a=H.indexOf(t.key);-1===a&&(a=0);var o=e-a;o&&(w=!0,L(o))}(n)})}}var m=f(getHistoryState$1()),H=[m.key];function x(t){return u+createPath(t)}function L(t){c.go(t)}var O=0;function E(t){1===(O+=t)&&1===t?(window.addEventListener(PopStateEvent$1,g),n&&window.addEventListener(HashChangeEvent$1,P)):0===O&&(window.removeEventListener(PopStateEvent$1,g),n&&window.removeEventListener(HashChangeEvent$1,P))}var S=!1;var k={length:c.length,action:"POP",location:m,createHref:x,push:function(t,n){var i=createLocation(t,n,l(),k.location);d.confirmTransitionTo(i,"PUSH",o,function(t){if(t){var n=x(i),e=i.key,a=i.state;if(s)if(c.pushState({key:e,state:a},null,n),h)window.location.href=n;else{var o=H.indexOf(k.location.key),r=H.slice(0,o+1);r.push(i.key),H=r,p({action:"PUSH",location:i})}else window.location.href=n}})},replace:function(t,n){var r="REPLACE",i=createLocation(t,n,l(),k.location);d.confirmTransitionTo(i,r,o,function(t){if(t){var n=x(i),e=i.key,a=i.state;if(s)if(c.replaceState({key:e,state:a},null,n),h)window.location.replace(n);else{var o=H.indexOf(k.location.key);-1!==o&&(H[o]=i.key),p({action:r,location:i})}else window.location.replace(n)}})},go:L,goBack:function(){L(-1)},goForward:function(){L(1)},block:function(t){void 0===t&&(t=!1);var n=d.setPrompt(t);return S||(E(1),S=!0),function(){return S&&(S=!1,E(-1)),n()}},listen:function(t){var n=d.appendListener(t);return E(1),function(){E(-1),n()}},next:function(){if(v.length){var t=v.shift(),n=t.location,e=t.action;d.notifyListeners(n,e)}},queue:v};return k}var HashChangeEvent$2="hashchange",HashPathCoders={hashbang:{encodePath:function(t){return"!"===t.charAt(0)?t:"!/"+stripLeadingSlash(t)},decodePath:function(t){return"!"===t.charAt(0)?t.substr(1):t}},noslash:{encodePath:stripLeadingSlash,decodePath:addLeadingSlash},slash:{encodePath:addLeadingSlash,decodePath:addLeadingSlash}};function stripHash(t){var n=t.indexOf("#");return-1===n?t:t.slice(0,n)}function getHashPath(){var t=window.location.href,n=t.indexOf("#");return-1===n?"":t.substring(n+1)}function pushHashPath(t){window.location.hash=t}function replaceHashPath(t){window.location.replace(stripHash(window.location.href)+"#"+t)}function createHashHistory(t){void 0===t&&(t={}),canUseDOM||invariant(!1);var n=window.history,e=(supportsGoWithoutReloadUsingHash(),t.getUserConfirmation),i=void 0===e?getConfirmation:e,a=t.hashType,o=void 0===a?"slash":a,c=t.basename?stripTrailingSlash(addLeadingSlash(t.basename)):"",r=HashPathCoders[o],s=r.encodePath,h=r.decodePath;function u(){var t=h(getHashPath());return c&&(t=stripBasename(t,c)),createLocation(t)}var f=createTransitionManager();function l(t){_extends(O,t),O.length=n.length,f.notifyListeners(O.location,O.action)}var d=!1,v=null;function p(){var t,n,e=getHashPath(),a=s(e);if(e!==a)replaceHashPath(a);else{var o=u(),r=O.location;if(!d&&(n=o,(t=r).pathname===n.pathname&&t.search===n.search&&t.hash===n.hash))return;if(v===createPath(o))return;v=null,function(n){if(d)d=!1,l();else{f.confirmTransitionTo(n,"POP",i,function(t){t?l({action:"POP",location:n}):function(t){var n=O.location,e=y.lastIndexOf(createPath(n));-1===e&&(e=0);var a=y.lastIndexOf(createPath(t));-1===a&&(a=0);var o=e-a;o&&(d=!0,m(o))}(n)})}}(o)}}var g=getHashPath(),P=s(g);g!==P&&replaceHashPath(P);var w=u(),y=[createPath(w)];function m(t){n.go(t)}var H=0;function x(t){1===(H+=t)&&1===t?window.addEventListener(HashChangeEvent$2,p):0===H&&window.removeEventListener(HashChangeEvent$2,p)}var L=!1;var O={length:n.length,action:"POP",location:w,createHref:function(t){var n=document.querySelector("base"),e="";return n&&n.getAttribute("href")&&(e=stripHash(window.location.href)),e+"#"+s(c+createPath(t))},push:function(t,n){var r=createLocation(t,void 0,void 0,O.location);f.confirmTransitionTo(r,"PUSH",i,function(t){if(t){var n=createPath(r),e=s(c+n);if(getHashPath()!==e){v=n,pushHashPath(e);var a=y.lastIndexOf(createPath(O.location)),o=y.slice(0,a+1);o.push(n),y=o,l({action:"PUSH",location:r})}else l()}})},replace:function(t,n){var o="REPLACE",r=createLocation(t,void 0,void 0,O.location);f.confirmTransitionTo(r,o,i,function(t){if(t){var n=createPath(r),e=s(c+n);getHashPath()!==e&&(v=n,replaceHashPath(e));var a=y.indexOf(createPath(O.location));-1!==a&&(y[a]=n),l({action:o,location:r})}})},go:m,goBack:function(){m(-1)},goForward:function(){m(1)},block:function(t){void 0===t&&(t=!1);var n=f.setPrompt(t);return L||(x(1),L=!0),function(){return L&&(L=!1,x(-1)),n()}},listen:function(t){var n=f.appendListener(t);return x(1),function(){x(-1),n()}}};return O}function clamp(t,n,e){return Math.min(Math.max(t,n),e)}function createMemoryHistory(t){void 0===t&&(t={});var o=t.getUserConfirmation,n=t.initialEntries,e=void 0===n?["/"]:n,a=t.initialIndex,r=void 0===a?0:a,i=t.keyLength,c=void 0===i?6:i,s=createTransitionManager();function h(t){_extends(p,t),p.length=p.entries.length,s.notifyListeners(p.location,p.action)}function u(){return Math.random().toString(36).substr(2,c)}var f=clamp(r,0,e.length-1),l=e.map(function(t){return createLocation(t,void 0,"string"==typeof t?u():t.key||u())}),d=createPath;function v(t){var n=clamp(p.index+t,0,p.entries.length-1),e=p.entries[n];s.confirmTransitionTo(e,"POP",o,function(t){t?h({action:"POP",location:e,index:n}):h()})}var p={length:l.length,action:"POP",location:l[f],index:f,entries:l,createHref:d,push:function(t,n){var a=createLocation(t,n,u(),p.location);s.confirmTransitionTo(a,"PUSH",o,function(t){if(t){var n=p.index+1,e=p.entries.slice(0);e.length>n?e.splice(n,e.length-n,a):e.push(a),h({action:"PUSH",location:a,index:n,entries:e})}})},replace:function(t,n){var e="REPLACE",a=createLocation(t,n,u(),p.location);s.confirmTransitionTo(a,e,o,function(t){t&&(p.entries[p.index]=a,h({action:e,location:a}))})},go:v,goBack:function(){v(-1)},goForward:function(){v(1)},canGo:function(t){var n=p.index+t;return 0<=n&&n<p.entries.length},block:function(t){return void 0===t&&(t=!1),s.setPrompt(t)},listen:function(t){return s.appendListener(t)}};return p}exports.createBrowserHistory=createBrowserHistory,exports.createBrowserTransitionHistory=createBrowserHistory$1,exports.createHashHistory=createHashHistory,exports.createMemoryHistory=createMemoryHistory,exports.createLocation=createLocation,exports.locationsAreEqual=locationsAreEqual,exports.parsePath=parsePath,exports.createPath=createPath;
